jQuery(document).ready(function($){
  'use strict';

  $('.extf-colour-picker').wpColorPicker();

  $('#extf-toggle-consumer-fields').click(function() {

    if(this.checked) {
      $('.extf-consumer-hidden').addClass('show');
    } else {
      $('.extf-consumer-hidden').removeClass('show');
    }

  });

  var $referer = jQuery('input[name=_wp_http_referer]');

  if( $referer.attr('value').indexOf('page=extf') !== -1 ) {
    var tmp = extfRemoveURLParameter($referer.attr('value'),'message');
    $referer.attr('value', tmp);
  }

  function extfRemoveURLParameter(url, parameter) {
    //prefer to use l.search if you have a location/link object
    var urlparts = url.split('?');
    if (urlparts.length>=2) {

      var prefix = encodeURIComponent(parameter)+'=';
      var pars = urlparts[1].split(/[&;]/g);

      //reverse iteration as may be destructive
      for (var i = pars.length; i-- > 0;) {
        //idiom for string.startsWith
        if (pars[i].lastIndexOf(prefix, 0) !== -1) {
          pars.splice(i, 1);
        }
      }

      url = urlparts[0] + (pars.length > 0 ? '?' + pars.join('&') : "");
      return url;
    } else {
      return url;
    }
  }

});
